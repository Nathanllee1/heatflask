<!DOCTYPE html>
<html>
  <head>
    <title>Activities List</title>
    <style>
      #data {
        text-align: center;
      }
    </style>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">

    <!-- JQuery -->
    <script src="{{ url_for('static', filename='js/jquery-3.1.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery-ui.min.js') }}"></script>
    <!-- <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script> -->
  </head>
  <body>

  <h2>Activities list</h2>
  <br>
  <div class="table-responsive">
   <table class="table table-hover table-sm table-bordered" id="activities_list">
  <thead>
    <tr>
      <th>id</th>
      <th>date</th>
      <th>type</th>
      <th>name</th>
      <th>Strava link</th>
      <th>Heatflask link</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
  </div>


  <div id="status"></div>

  <script>
    jQuery(document).ready(function($) {
        var source = new EventSource("{{ url_for('activity_stream', username=user.id, limit=limit) }}");
        var count = 0;
        $("#status").text("Getting Activity List");

        source.onmessage = function(event) {
          // console.log(event.data);
          if (event.data != 'done'){
            var a = JSON.parse(event.data),
                row,
                link,
                highlight;

            if (a.cached == "yes"){
                highlight = "class='table-active'";
            } else {
              highlight = "";
            }

            strava_link = "<a href='https://www.strava.com/activities/" +a.id + "' target='_blank'>Strava " + a.id +"</a>"
            heatflask_link = "<a href={{ url_for('main',username=user.id) }}?id=" +a.id + " target='_blank'> Heatflask " + a.id +"</a>"
            row = "<tr " + highlight +  ">" +
                   "<th scope='row'>" + a.id + "</th>" +
                   "<td>" + a.beginTimestamp +"</td>" +
                   "<td>" + a.type + "</td>" +
                   "<td>" + a.name + "</td>" +
                   "<td>" + strava_link + "</td>" +
                   "<td>" + heatflask_link + "</td>" +
                   "</tr>";
            $('#activities_list tbody').append(row);

            count++;
          } else {
            source.close();
            $("#status").text("Listing " + count + " activities");
          }
        }
    });
  </script>
 </body>
</html>

