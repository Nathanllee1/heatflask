<!DOCTYPE html>
<html>
<head>
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    {% assets "basic_table_css" %}
    <link rel="stylesheet" href="{{ ASSET_URL }}" />
    {% endassets %}

    {% assets "basic_table_js" %}
    <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}
</head>

<body>
    <h3> Registered Users </h3>
    <table id="users_table" class='display order-column' cellspacing='1' width='100%'>
    </table>

    <script>
    function href(url, text){
        return `<a href='${url}' target='_blank'>${text}</a>`
    }

    function formatID (data, type, row) {
        if (type == "display") {
            return href("/" + data, data);
        } else {
            return data;
        }
    }

    function formatDate(data, type, row, meta) {
        date = new Date(data);
        return type === "display" || type === "filter" ?
            date.toLocaleString('en-US', { hour12: false }) : date;
    }

    function combineNames(data, type, row, meta) {
        return row.lastname + ", " + row.firstname;
    }

    let data = {{ data|tojson}};
    let atable = $('#users_table').DataTable({
            paging: false,
            data: data,
            columns: [
                {title: "ID",    data: "id", render: formatID},
                {title: "count", data: "app_activity_count"},
                {
                    title: "last active",
                    data: "dt_last_active",
                    render: formatDate,
                },
                {title: "Name", render: combineNames},
                {title: "City",    data: "city"},
                {title: "Country", data: "country"},
                {title: "email",   data: "email" }
            ],
            scrollY: "80vh",
            scrollX: true,
            scrollCollapse: true,
            select: true,
            order: [[ 1, "desc" ]]
        });
    </script>
</body>
</html>
